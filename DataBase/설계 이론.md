# DB 설계 이론

좋지 않은 테이블은 다음과 같은 3가지 이상을 가지고 있다

- 갱신 이상
- 삭제 이상
  - 마지막 튜플이 삭제될 경우 다른 정보가 함께 삭제된다
- 입력 이상

## 함수 종속성

함수 종속성은 일부 속성의 값이 다른 속성의 값을 유일하게 결정하는 것을 의미하며 키 개념의 일반화라고도 볼 수 있다  
만약 t1(a) = t2(a)이면, t1(b) = t2(b)를 만족하면, a가 b를 함수적으로 결정한다고 한다

함수 종속성의 왼쪽 속성이 모든 속성을 결정하면 그 속성은 슈퍼 키가 된다  
위의 조건에 추가로 왼쪽 속성의 부분 집합이 모든 속성을 결정하지 못하면 왼쪽 속성은 후보키가 된다

함수 종속성이 모든 인스턴스에 대해 만족하는 경우 그러한 함수 종속성을 trivial(무의미)이라고 한다  

함수 종속성은 다른 함수 종속성으로부터 유추할 수 있는데, 유추할 수 있는 모든 함수 종속성의 집합을 **함수 종속성 폐포**라고 한다  

함수 종속성은 다음 두가지 용도로 사용한다

- 주어진 관계 인스턴스의 유효성을 검사
- 적법한 테이블의 제약 조건을 명시

### 암스트롱 공리

함수 종속성을 유추할 수 있는 규칙으로 **암스트롱 공리**가 있다.  
암스트롱 공리는 3가지가 존재한다

- reflexivity
  - 재귀성 규칙, 무의미한 함수 종속성을 생성
- argumentation
  - 주어진 함수 종속성 양쪽에 같은 속성을 추가해도 동일함
- transivity
  - a->b, b->c일 때 a-> c임

암스트롱 공리는 건전하고 완전하다  
건전함은 새롭게 생성되는 규칙이 유효하다는 특성이고, 완전함은 모든 유효한 함수 종속성을 암스트롱 공리로 유추할 수 있다는 특성이다

추가 추론 규칙이 존재한다

- union
- decomposition
- pseudotransitivity

### 속성 폐포

주어진 속성이 함수적으로 결정할 수 있는 모든 속성을 속성 폐포라고 한다.  
주어진 함수 종속성의 왼쪽 속성이 현재까지 구한 속성 폐포에 포함되어 있으면 그 속성의 오른쪽 속성을 속성 폐포에 추가한다.

사용 방법

- 주어진 속성이 슈퍼키인지 검증할 때 사용
- 주어진 함수 종속성이 유효한지 검증
  - a->b에 대해서 a의 폐포에 b가 속하면 a->b는 유효한 함수 종속성임

### 정규 커버

정규 커버는 주어진 함수 종속성과 같은 표현력을 가지면서 최소한의 속성 및 함수 종속성을 가지는 집합이다  
자세한 정의는 다음과 같다

- 주어진 함수 종속성과 같은 의미를 가져야 함
- 중복된 속성이 없어야 함
- 왼쪽이 unique 해야함



## 정규형

### 1정규형

1 정규형은 도메인의 값이 모두 atomic 해야한다

set, list, bag 등이 포함되면 안된다

### 2정규형

- 주요 속성
  - 후보 키에 속하는 속성
- 비주요 속성
  - 후보키에 속하지 않는 속성
- 완전 함수 종속성
  - ab->c에 대해 ab로만 c를 결정할 수 있음
- 부분 함수 종속성
  - ab->c에 대해 a 또는 b로도 c를 결정할 수 있음

2 정규형은 1정규형의 조건에 더해 모든 비주요 속성이 후보키에 완전히 의존적어야 함

### 3정규형

3 정규형은 2 정규형의 조건에 더해 비주요 속성이 모든 후보키에 이행적으로 의존적이지 않아야 한다

또 다른 정의로는 모든 의미있는 함수 종속성 a->b에 대해서 a가 슈퍼키 이거나 b가 주요 속성 이어야 한다

### BCNF

BCNF는 2정규형의 조건에 더해 모든 의미있는 함수 종속성 a->b에 대해서 a가 슈퍼키이어야 한다  
3정규형의 또다른 정의의 두번째 조건을 제외한 것이다

속성이 두개인 테이블은 항상 BCNF이다