# IP 

## 주소 체계



## DHCP

## NAT

공인 IP는 전 세계적으로 고유한 IP 주소다. 공인 IP가 할당된 기기는 어디서나 접근이 가능하다.

사설 IP는 고유하지 않은 IP 주소다. 로컬 네트워크에서만 사용되는 IP이며 다른 네트워크에도 중복된 IP 주소가 있을 수 있다. 다른 네트워크에서도 같은 IP를 사용할 수 있기 때문에 글로벌 인터넷에서는 사용할 수 없다. 오로지 주어진 로컬 네트워크 내부에서만 사용 가능한 주소이다.

사설 IP로 지정된 대역은 다음과 같다

- 10.0.0.0 ~ 10.255.255.255
- 172.16.0.0 ~ 172.31.255.255
- 192.168.0.0 ~ 192.168.255.255

**NAT**(Network Address Translation)은 사설 IP와 공인 IP사이를 변환하는 방법이다. 내부 네트워크는 사설 IP를 할당받고, NAT 기능이 있는 라우터의 WAN 인터페이스에 공인 IP를 할당받는다.

그냥 모든 호스트에 공인 IP주소를 할당받아서 사용하지 않고 이런 번거로운 과정을 거치는 이유가 있다. 

- IP 주소를 절약할 수 있다.
  - IPv4 주소가 부족한 상태이기 때문에 사설 IP를 사용하여 IP 주소의 사용량을 감소시킬 수 있다.
- 외부에 알리지 않고도 로컬 네트워크의 IP 주소를 변경할 수 있다
- 로컬 네트워크의 IP를 변경하지 않고 ISP를 변경할 수 있다.
- 외부에서 호스트에 직접 접근할 수 없기 때문에 보안상의 이점이 있다.

변환 과정은 다음과 같다.

1. 내부 호스트가 외부 서버에 요청을 보낸다. 
   - source: 10.0.0.1:3345, dest: 128.119.40.186:80

2. 라우터는 패킷을 받아서 source IP와 포트를 변경하고 NAT 변환 테이블에 기록한 후에 목적지로 전송한다.
   - IP는 라우터의 WAN 인터페이스의 주소, 포트는 새로운 번호 선택.

   - 포트 번호로 식별하기 때문에 NAT 변환 테이블에 존재하지 않는 새로운 번호를 선택해야 함.

   - | WAN side addr    | LAN side addr |
     | ---------------- | ------------- |
     | 138.76.29.7:5001 | 10.0.0.1:3345 |

3. 서버는 패킷를 받아서 처리한 후 응답한다.
   - source: 128.119.40.186:80, dest: 138.76.29.7:5001

4. 라우터는 응답의 목적지 IP와 포트를 NAT 변환 테이블에서 찾고, 해당되는 LAN 주소로 변환한다.
   - source: 128.119.40.186:80, dest: 10.0.0.1:3345
