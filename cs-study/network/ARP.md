# ARP

ARP 프로토콜에 대해 알아보기 전에 MAC 주소에 대해 먼저 알아야 한다. **MAC 주소**는 네트워크 인터페이스에 할당된 고유한 식별 주소다. 48비트의 값으로 이루어져 있으며 앞의 24비트는 장비 제조사의 식별 번호이고 뒤의 24비트는 각각의 장비에 시리얼 넘버다. 기본적으로 변경할 수 없고 영구적이도록 설계되었지만 현재는 소프트웨어를 사용해 변경할 수 있다. 브로드캐스트 주소는 48비트를 전부 1로 채운 FF-FF-FF-FF-FF-FF이다.

MAC 주소는 하드웨어에 부여된 값이기 때문에 어떤 네트워크에 연결하든 값이 변하지 않는다. 이것이 IP주소와 다른 점이며, IP 주소는 호스트가 다른 네트워크에 접속하면 주소가 변경될 수 있다. 비유하자면 MAC 주소는 사람에게 부여된 주민등록번호와 같고 IP 주소는 이사갈 때마다 바뀌는 우편 번호와 같다.

**ARP**는 IP 주소를 MAC 주소로 변환하는 프로토콜이다. 반대의 과정으로는 RARP 프로토콜이 존재한다.

과정은 다음과 같다.

1. 목적지 MAC 주소를 브로드캐스트 주소로 설정하고 ARP 패킷을 어댑터에게 전송.
2. 어댑터가 서브넷의 다른 노드들에게 전송함
3. 패킷에 있는 목적지 IP 주소가 자신의 것과 같은 노드는 요청을 수신하고 응답 ARP 패킷을 전송함
   - 응답 패킷에 자신의 MAC 주소가 포함되어 있음

ARP는 같은 서브넷에 있는 호스트나 인터페이스의 MAC 주소만 변환한다. 다른 서브넷에 있는 노드와 통신할 경우에는 다음과 같은 과정을 거친다.

- 먼저 ARP를 통해 첫번째 홉 라우터의 MAC 주소를 알아낸다.
- 목적지 IP 주소는 최종 목적지 노드, 목적지 MAC 주소는 홉 라우터로 설정한 후 전송한다.
- 라우터는 받은 프레임의 목적지 MAC 주소가 자신의 MAC 주소와 같은지 확인한다.
  - 같다면 프레임을 처리하고 IP 헤더의 목적지 IP 주소와 라우팅 테이블을 확인해서 다음 홉을 결정한다.
  - 패킷을 캡슐화해서 새 프레임을 생성해 전송한다.(출발지 MAC: 현재 라우터, 목적지 MAC: 다음 홉 라우터)
- 최종 목적지와 같은 서브넷에 연결된 라우터가 ARP를 이용해 최종 목적지의 MAC 주소를 알아내고 마지막으로 데이터를 전송한다.

또한 전송할 때는 브로드캐스트로 보내지만 응답을 받을 때는 유니캐스트로 받는다. 당연하게도 찾을 때는 모두에게 물어봐야 하지만 대답은 한명만 하면 되기 때문이다.

각각의 호스트와 라우터는 내부적으로 ARP 테이블을 가지고 있다. 이는 IP와 MAC 주소간의 매핑 정보, 값이 삭제되는 시간인 TTL을 포함한다. ARP 프로토콜이 정상적으로 수행되면 ARP 테이블에 매핑 정보를 저장한다. ARP는 플러그 앤 플레이로 작동하기 때문에 시스템 관리자가 따로 테이블을 구성할 필요가 없이 자동으로 테이블을 생성한다. 테이블 예시는 다음과 같다.

| IP 주소         | MAC 주소          | TTL      |
| --------------- | ----------------- | -------- |
| 111.111.111.111 | 2A:F3:D8:41:C7:E5 | 14:28:00 |
| 111.111.111.112 | B6:29:8C:75:A4:12 | 14:35:00 |
