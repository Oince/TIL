# Redis 캐싱 전략

## Redis란

redis는 원격 서버에 인 메모리 기반의 key-value 구조로 데이터를 관리하는 시스템이다. key-value로 저장하기 때문에 쿼리 연산을 지원하지는 않지만 데이터를 빠르게 읽고 쓰는데 특화되어 있다. 또한 메모리에서 작동하기 때문에 디스크를 사용하면 다른 DB보다 속도가 훨씬 빠르다.

이런 특징때문에 redis는 캐시 서버로 자주 쓰인다.

## 캐시 전략

### 읽기

#### Look Aside

- 데이터를 찾을 때 캐시에 저장된 데이터가 있으면 우선적으로 캐시에서 가져옴
- 캐시에 없으면 DB에서 조회하고 캐시에 저장
- 장점
  - 원하는 데이터만 따로 캐시에 저장해놓고 사용할 수 있음
  - 캐시가 DB와 분리되어 있기 때문에 redis에 장애가 발생해도 서비스 제공에 문제가 없음
- 단점
  - 데이터 정합성 문제가 발생할 수 있음 
  - 초기 조회시 무조건 DB를 호출해야 하기 때문에 단건 호출이 많은 경우 적합하지 않음
    - 반복적인 읽기가 많은 경우에 적합
  - 장애 발생시 캐시에 있던 connection이 전부 DB로 몰리기 때문에 부하 발생함

#### Read Through

- 캐시에서만 데이터를 가져오는 전략
- 캐시에 없는 경우 직접 DB를 호출하는 것이 아닌 redis가 DB를 호출해서 데이터를 가져옴
- 장점
  - 캐시와 DB 간의 데이터 동기화가 항상 이루어지기 때문에 데이터 정합성을 지킬 수 있음
- 단점
  - 한 단계 더 거쳐서 가져오기 때문에 전체적인 속도가 비교적 느림
  - redis에 장애 발생시 서비스 이용에 문제가 생김
    - 이런 상황에 대비하기 위해서 redis를 클러스터로 구성해서 가용성을 높임

### 쓰기

#### Write Back

- 캐시와 DB를 동기화하지 않음
- 데이터를 저장할 때 캐시에서 모았다가 나중에 한번에 저장함
- 장점
  - 쓰기 쿼리 비용과 부하를 줄일 수 있음
  - 데이터 정합성을 확보할 수 있음
- 단점
  - 캐시에서 오류가 발생하면 데이터가 유실될 수 있음
  - 자주 사용하지 않는 불필요한 데이터도 일단 캐시에 저장하기 때문에 리소스 낭비의 가능성이 있음

#### Write Through

- 캐시에 저장하고 난 후에 바로 DB에도 저장함
- 장점
  - 데이터를 바로 저장하기 때문에 유실의 위험이 낮음
  - 캐시의 데이터가 항상 최신 상태로 유지됨
- 단점
  - 모든 요청마다 2번의 쓰기가 발생하기 때문에 상대적으로 성능이 낮음
  - 자주 사용하지 않는 불필요한 데이터도 일단 캐시에 저장하기 때문에 리소스 낭비의 가능성이 있음

#### Write Around

- 캐시를 통하지 않고 바로 DB에 저장
- 캐시 미스가 발생하면 그때 캐시에 저장함
- 장점
  - Write Through에 비해 빠름
- 단점
  - 캐시를 갱신하지 않기 때문에 데이터 정합성 문제가 발생할 수 있음